{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "RestAction",
  "type": "object",
  "additionalProperties": false,
  "required": ["type", "id", "request"],
  "properties": {
    "type": {
      "const": "rest",
      "description": "Type discriminator; must be 'rest'."
    },
    "id": {
      "type": "string",
      "minLength": 1,
      "pattern": "^[A-Za-z_][A-Za-z0-9_]*$",
      "description": "Logical identifier for this action."
    },
    "description": { "type": "string" },

    "request": {
      "type": "object",
      "additionalProperties": false,
      "required": ["method", "url"],
      "properties": {
        "method": {
          "type": "string",
          "enum": ["GET", "POST", "PUT", "PATCH", "DELETE", "HEAD", "OPTIONS"],
          "description": "HTTP method (uppercase)."
        },

        "url": {
          "$ref": "#/$defs/NonEmptyStringOrExpr",
          "description": "Target URL or URL template (literal or expression)."
        },

        "headers": {
          "type": "object",
          "description": "Optional HTTP headers. Values may be literal or expressions.",
          "propertyNames": { "$ref": "#/$defs/HeaderName" },
          "additionalProperties": { "$ref": "#/$defs/NonEmptyStringOrExpr" }
        },

        "query": {
          "type": "object",
          "description": "Optional query parameters. Values may be literal scalars or expressions.",
          "propertyNames": { "$ref": "#/$defs/QueryParamName" },
          "additionalProperties": { "$ref": "#/$defs/ScalarOrExpr" }
        },

        "body": {
          "description": "Optional request body. May be JSON (object/array), a string, or an expression.",
          "oneOf": [
            { "type": "object" },
            { "type": "array" },
            { "$ref": "#/$defs/NonEmptyStringOrExpr" },
            { "type": "null" }
          ]
        }
      }
    }
  },

  "$defs": {
    "Expression": {
      "type": "string",
      "pattern": "^\\$\\{~[^}]+~\\}$",
      "description": "Expression placeholder in the form ${~ ... ~}."
    },

    "NonEmptyString": {
      "type": "string",
      "minLength": 1
    },

    "NonEmptyStringOrExpr": {
      "description": "Either a non-empty literal string or an expression placeholder.",
      "anyOf": [
        { "$ref": "#/$defs/Expression" },
        { "$ref": "#/$defs/NonEmptyString" }
      ]
    },

    "Scalar": {
      "type": ["string", "number", "boolean", "null"]
    },

    "ScalarOrExpr": {
      "description": "Either a scalar literal (string/number/boolean/null) or an expression placeholder.",
      "anyOf": [
        { "$ref": "#/$defs/Expression" },
        { "$ref": "#/$defs/Scalar" }
      ]
    },

    "HeaderName": {
      "type": "string",
      "minLength": 1,
      "pattern": "^[A-Za-z0-9-]+$",
      "description": "HTTP header field-name (token)."
    },

    "QueryParamName": {
      "type": "string",
      "minLength": 1,
      "pattern": "^[A-Za-z0-9_.-]+$",
      "description": "Query parameter name."
    }
  }
}